/*
 * Copyright (c) 2022 gematik GmbH
 * 
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package de.gematik.idp.sektoral.services;

import de.gematik.idp.sektoral.exceptions.IdpSektoralException;
import java.net.URISyntaxException;
import lombok.extern.slf4j.Slf4j;
import org.apache.http.client.utils.URIBuilder;
import org.springframework.stereotype.Service;

@Service
@Slf4j
public class SektoralIdpAuthenticator {

    public static final String HARD_CODED_AUTH_CODE = "eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIiwiZXhwIjoxNjMxNzA4NDM1LCJjdHkiOiJOSldUIn0..78hdxBHZ5rLviYRd.ZbDg1200eJcwoJShOY9XJN6MCRzTg-sjStGvt6vYlfzzKJzoJgTCzyQIOxK6M7Vu2kv-lXMgiRZII7aetCvaj_1kXiZTfTiBUKdPs7erYqV_Yt97Fa0JWIERM61AGvheBK96E1j51G6GjP-1bE3v-cZK2qSfL8pVm8HfKP5uu5m-cg3vwlZGma1M_udvDe-IZxVl19eY-Pcig_3q37Q2jwpWqg3vBhvAOgheLnQJFeIkygVzhuLjMJdlFl5u48ZbrVUaYli_vuiVUwEIroXEzntXGBB4PXgjk2i3J94RNUcjgmjnUVYA0cmNUzoXt95sTfWV5t7oUZrPt84L0i3UHsHw9OFUKfWWOlYfQeuj5dk_ZZ1SC_I0TQfpV2EQ_hDa4sEH-i6ji-vQgfoZ8ckMD4dVXqmNbVGIExf99f7NZi75AY2GmscRlQ47YvAtYdwWmvlUrI4xNTVgB2jcQ4Bf8fuo2o_C5GTIuJYqrJiXncuV4cRm8Q0VHN6WCtCfiDONxM1MhqVrUrD0d-hhDR5zAaFCOmPw84iTE-2T8ssjdUTBQCKGOtXPsXA8ZKJFMcGXF2CfRJnfVAlx0Cbpav5tmUPjOkjvScarfo1Y-gzeZ3lhbplRV4LB0NLPC4DmuftazKklWoMg5pqHDofFlW_FKYWiO2Wt8eBd68g2YDDeF9lkrsj6_U_4aHTI2Bvt_QRgy5L49VG2K3iALXtL3-fHB-zuZuHpVWxWXMDp-kG9NaOgE9RLaYgLeQJTyUShb3D9ckgnv38qI5iYUazush976zaNicvis7fafIfJxUhddMqnJOwlCyE9nedST3ULHksviZEgRE2DGhB6-qKw7lEDJNG8YD38DuY_BBH758mluzkh2ZBa5UeeB5MnCN9VFvrzSRkLYOlEG6BKg3ezQDNu3TkV7eLyGpJIh1w3DHZ6Fsv1UyY5lS1CtkuuZ_xMtTAwhwLqRUnXnji19sQqBxgVEQUhkCO32ojwVkh37ghxz2XLrLwQgIFvBMZ0XLjcrvGonseXVF1Hiap1JmrjBUVKG_SIhcOOrgtNFfdpTubDG_UnVVwRD40SIaIYq6FhpqZ7hb4foTCFUTiAfP6Ohs4bXXeP2yDJF3jElpcKRUfnnuCohM2k7YQkVV56nKBtHsddgQ5hM3X2v8XrxR93doI8gwl4OxXy-GHiNBVNuvNEEn5NGMd0WGs01UlNP0Q2brA_4KuuwrehEPuLGRDJkBRtAFfU_Y47s5Qi1-ihuPS6fKUEKKKKfhI7_j4r1WGILyzN6YlA5mCSRPnAI8GloFfMja-8pRYESQiM2Cv-bJV4FgEE6Mtaj7iE8aZ9wMqma1OR7mAViq2Ow3RX.HAMWfwJzWvEEVtNU1t4I_A&ssotoken=eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIiwiZXhwIjoxNjMxNzUxNTc1LCJjdHkiOiJOSldUIn0..ROQ4yOv3v4CpbkKM.mBZYaOOZA1lRK8-26_s8Rs3n1StF6UgBxCwjR7qAQiXyiu0qEASb_PfWDprQOV93LbYdu4JlsWh3KU6pVIw7JqOz_IZG6wC1y0jYpYrKy2C5ZhEVK-31LFdXjLKGExwrIXjMWsS6szon4phfWuCGz6BSlnwFkJZY4kOoLEPQTW7auYpMuLm0jLvG8kiLJshYZ1InLXx-9MjgMTu8BS0N2m7y8dE4aed8U9VPPFPehawIC3Mwh7vXOcvwugVpqUQLWjE80HeZPNVuEeHqT3RFIsw3HLMNt51_KLFnke4HQnAuK61QAtlWxIc92UtzU35RZIvsp-vu_HsYRaX0KBCgDktl9mrgE8yJyJVxJcnL-V_2zPNJReRu8FnfHdCHRlvLoq_X-oja2nGtSjLb4UiN95ox3LgrHeyqWGLAtUK8caVAwCS_L77fysCiwJu49obIEedwv3Iosp4-3dYKv57XuQ1gUxp4Nyzr-nRtn2FzCdECH-rlryV-zgqBt9r89BF7DfhblTOh5LXLWrbihxYJZ9K39fyIOaZ_7FEPuNqgEBfx4l_fiRrwLGUDboSQdScFOOJh8oCkMgKLCeS1mAXz4dTbGaiFTDCSBbXMPIp0IOqkoI6jN_1B61OfmCUrD0Vmj0-CsjIpVzsrLCazpAIGWQ73Ym2DJM0BiEVfDW3tCqDyn-T63cRT2tKvwqgVDyPvRoWRuANQ8ny9OnkDgGvJHajei5XDt3yo7n8IcdJqikw6fm-XH1BNzZCYlJTI7XTlYNDh32BJvm1N3HKz3GIxTI7aD8YRwbGPVYfZggFaFtyw6FOMGM_dnSYndCD3b5jgEvHyFOJafxtRMiOAOAVVHOwXzhvCO2gdar_Rfb15efy77Eh6Oh5DwjbxjsNhO3XX_mujkG1eCkRBuV9yrEpKIVrVUmbElQUG-Tjn03fW0IkPPXYesEEZOT7BJcJu2IwxEXbLWx68ojcXzmpImYxAA3DjFz22hsIIKKjPZiRmckRVPVOzOw9jiL3X7nlgBBOMGAvKnOdAYjxKaDaH-xHLEqw7Yhr245HKiIzCv1bOb0c4hg-NCaX6xD39rckrsmUEaC-wA5WWGvQh5v-QebcuMR7UA2nzlUtZ_P0xTkRDILE4qpe79q9iX-9X-YAQ0Lnrwp_3bAcnDAmwVcHJy8jW8vU4VwH5fuRTKh5QfdIAge40Ei1d8ZpUYsJ9QoiArtmARwpFtnJ8UjyrcF_qvW6KUYn8jE0qvN2BDZot4lawOpjIdsYq9bpP7B-l257eW3lQ_notkGOpKofciTmDQvmXwsBJbBQtQuAxScq_joPzwiB2VKJIF1Kl104wn6anKZiM_MyPYKWNGxfl6vXd3JCmumXh8vtFP75S8UuEB-y1J8eEeG0_rlNm-8zIJuFXwkJ9TLE1xcRjZZpTWVIQucECJR96djXdVvZ3OdO18d5ORwdOAduMBcfGBthWoyXa7gBzXlwwC5G2wk9dLXWli0J7IO5B6sHWyBRQJQPrqYoxK40vTaNYwuv3hOsXG8dfzULDpFD6yyKcKR34KYDl5NByRfZghG3YW5xHhjN5jYmLSEYoZ15EB80HPt0tEMqdmjCb_DNGf8lbBLgb03Qk2xxeEQbNRzDiU5FuB1d6pUmftr1SvBUIRdFLvQoMc_4gFc-YrDqDr1YzitaVsSAbED0yrpijkPR4tByDN3qfz-oRtzohI4gVp38uKS2UOxtf0zIZMJqPmhEHtpMDbI9VWgJiDRfqtUIL1R4fe0wh83rlFyO4wtXwTjREDsIWxm2LchbemWh0OZS3z2CQkwKWK6SsxXXUkRrGDgs5pcDYJkHsUOk56yJ4EFo-4kY67uCCvR-W_nog6HNt8Jr5iQJSk2hKihV8FEQbEKbIM27rYGkwnQfZW-2dZyXAS62Grnwq8GXfvXnj4iz2oVYgrJuOitzOH01NVImVUkAbobypb1DDtYEB0TjX-EuzqtXAUVZe3Vp22AzTq9j3Dwa650VwFGj25v9xZkKHuLzgN8yWKx79L7OtP8oYcjr3KoTihUkNyk4nAexo3ZZC6EXoGECUGBnzqBT2NMCg37ftoKvsIejF8azBs-3x-2ImgR7NDxATQSAIvKzK5aH4tkPwYpWESCOe3WiNf5C6y-H3YM4casm8kbK54PLq-CNTU6AR_B6fjldIgd1S2I51J33cTODK2dxY354ZKv4fSq1ZPTC87EKYVrpRPv0FIWSFyzH588VNSiiB-I3Bcy13a8qM_cuNRuyl508-0FUm-rUAoCGlCDKEfHAnGL4QHnfk_akn_NE0XBv7WmJja5FiTcE8tV4PFzCx8si1AwV-7VZ9HgfBD2DxuTwMKhEEkVO7O5Nmu7hdB_T0ZKQVJktevLNFcIszXIj58uLlp94CTfGPo4hbbMs1HdSX1tbvBHyh0ebqAmcYQg0OyrpRW4mLXiGfebn0-d5NNkyBF8Faf3vT5d-wHMGa9D5PyDLPvqaz0jnrBfuxjXRh0_OH5dFYvTGAHSHtmhhGtEBLRbUxoh7LUawpTdulmVj-DCa4vBucI_p2OpYwOz1DCZsVIvcI6dlv3U4yZpn3rUX61DluK4GvQbWvK2CkeYZhsrhzQMamWJ_SOthDe0BQIs6poT1PdRkX0HeW6dq7o1kjamOpOcjTQciW_Rk23WIckjk_I6lfQHRzMvG10vEJfeGmuOGRdDuT-QXsBxD8a8cV9sfnzcCVf0Z-VoY6XWByxsuvRTT_Bpo07ggA1R8KntaREDYRMaMOg462IwlvernDNjCBamYCeik40ALhOPpnp5EwWq_xLTV9TB4lQH9U7HKWtDD5J0pi96q8c_5mxeYLKNWQoVUyr6Wb4RiwMWEs7mDAmAvaysOLpxE93vQLJ6NiuCjjw2Ei272jAjjKwsT72zyfH5WTcNKYnSGWZ1Dq8xl6swwMRVqnIfUcm677aUzLuk1sfCmuu01Ph_IQcFdz69rgwT4WzsjZs8YwVYwiuA1y0a8s2qbtKB9GSvwCYrNzejF9uM13HMkOgW_2bWiW6w3BjcqJ-LouPkr3VPpfuaSx3oENZk4vm2RzI_ccqVA1sowGorRl0zv8AsI8kFuOTEkK3UJxe0x883U-rvBS9IrJJw.USfoA5j175whtyyGCMpUbw";

    // code_challenge as a parameter is not considered here (Fasttrack messages nr.5 and 6 are not part of this implementation)
    public String createLocationForAuthorizationResponse(final String redirectUri, final String state) {

        try {
            final URIBuilder redirectUriBuilder = new URIBuilder(redirectUri);
            // Authorization Code hard coded here, Fasttrack messages nr.5 and 6 are not part of this implementation
            redirectUriBuilder.addParameter("code",
                    HARD_CODED_AUTH_CODE)
                .addParameter("state", state);
            return redirectUriBuilder.build().toString();
        } catch (final URISyntaxException e) {
            throw new IdpSektoralException(e);
        }

    }
}
